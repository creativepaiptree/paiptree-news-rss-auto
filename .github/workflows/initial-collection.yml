name: ğŸ“š Paiptree News Initial Collection

on:
  # ìˆ˜ë™ ì‹¤í–‰ ì „ìš© (ì´ˆê¸° ì„¤ì •ì‹œì—ë§Œ ì‚¬ìš©)
  workflow_dispatch:
    inputs:
      collection_mode:
        description: 'ìˆ˜ì§‘ ëª¨ë“œ ì„ íƒ'
        required: true
        default: 'initial'
        type: choice
        options:
        - initial
        - recent

jobs:
  initial-collection:
    runs-on: ubuntu-latest
    
    steps:
    - name: ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
    
    - name: Python ì„¤ì •
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        cache: 'pip'
    
    - name: ì˜ì¡´ì„± ì„¤ì¹˜
      run: |
        pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: í™˜ê²½ë³€ìˆ˜ ê²€ì¦
      env:
        GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_CREDENTIALS }}
        GOOGLE_SHEETS_ID: ${{ secrets.GOOGLE_SHEETS_ID }}
      run: |
        if [[ -z "$GOOGLE_CREDENTIALS" ]]; then
          echo "âŒ GOOGLE_CREDENTIALS ëˆ„ë½"
          exit 1
        fi
        if [[ -z "$GOOGLE_SHEETS_ID" ]]; then
          echo "âŒ GOOGLE_SHEETS_ID ëˆ„ë½"
          exit 1
        fi
        echo "âœ… í™˜ê²½ë³€ìˆ˜ í™•ì¸ ì™„ë£Œ"
    
    - name: ì´ˆê¸° ë‰´ìŠ¤ ëŒ€ëŸ‰ ìˆ˜ì§‘ ì‹¤í–‰
      env:
        GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_CREDENTIALS }}
        GOOGLE_SHEETS_ID: ${{ secrets.GOOGLE_SHEETS_ID }}
        INITIAL_COLLECTION: ${{ github.event.inputs.collection_mode == 'initial' && 'true' || 'false' }}
      run: |
        echo "ğŸš€ Paiptree ì´ˆê¸° ë‰´ìŠ¤ ìˆ˜ì§‘ ì‹œì‘"
        echo "ğŸ“… ì‹¤í–‰ ì‹œê°„: $(date)"
        echo "ğŸ¯ ìˆ˜ì§‘ ëª¨ë“œ: ${{ github.event.inputs.collection_mode }}"
        
        if [[ "${{ github.event.inputs.collection_mode }}" == "initial" ]]; then
          echo "ğŸ“š ì´ˆê¸° ëŒ€ëŸ‰ ìˆ˜ì§‘ ëª¨ë“œ: ê°€ëŠ¥í•œ ëª¨ë“  ê³¼ê±° ë‰´ìŠ¤ ìˆ˜ì§‘"
        else
          echo "ğŸ“… ìµœê·¼ ë‰´ìŠ¤ ëª¨ë“œ: ìµœê·¼ 7ì¼ ì´ë‚´ ë‰´ìŠ¤ë§Œ ìˆ˜ì§‘"
        fi
        
        # í–¥ìƒëœ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
        python rss_scraper_enhanced.py
    
    - name: ìˆ˜ì§‘ ê²°ê³¼ ìš”ì•½
      if: always()
      run: |
        echo "ğŸ‰ ì´ˆê¸° ë‰´ìŠ¤ ìˆ˜ì§‘ ì™„ë£Œ!"
        echo "ğŸ“… ì™„ë£Œ ì‹œê°„: $(date)"
        echo "âœ… ìƒíƒœ: ${{ job.status }}"
        echo ""
        echo "ğŸ’¡ ë‹¤ìŒ ë‹¨ê³„:"
        echo "1. Google Sheetsì—ì„œ ìˆ˜ì§‘ëœ ë‰´ìŠ¤ ë°ì´í„° í™•ì¸"
        echo "2. ì •ê¸° ìˆ˜ì§‘ì„ ìœ„í•´ ê¸°ë³¸ ì›Œí¬í”Œë¡œìš° í™œì„±í™”"
        echo "3. ë§¤ì¼ ìë™ ìˆ˜ì§‘ì´ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ ëª¨ë‹ˆí„°ë§"
